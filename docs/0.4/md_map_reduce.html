<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>GrPPI: Map/reduce pattern</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">GrPPI
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">Generic and Reusable Parallel Pattern Interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Map/reduce pattern </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The <b>map/reduce</b> pattern combines a <b>map</b> and <b>reduce</b> operation in a single pattern. In a <b>map/reduce</b> operation, firstly one or more input data sets are <em>mapped</em> by applying a transformation operation. Then, the results are combined by means of a reduction operation.</p>
<p>The interface to the <b>map/reduce</b> pattern is provided by function <code><a class="el" href="group__mapreduce__pattern.html#ga1b61366b1688dc6d2d8dc6cbf785bf10" title="Invoke md_map-reduce on a data sequence.">grppi::map_reduce()</a></code>. As all functions in <em>GrPPI</em>, this function takes as its first argument an execution policy.</p>
<div class="fragment"><div class="line"><a class="code" href="group__mapreduce__pattern.html#ga1b61366b1688dc6d2d8dc6cbf785bf10">grppi::map_reduce</a>(exec, other_arguments...);</div>
<div class="ttc" id="agroup__mapreduce__pattern_html_ga1b61366b1688dc6d2d8dc6cbf785bf10"><div class="ttname"><a href="group__mapreduce__pattern.html#ga1b61366b1688dc6d2d8dc6cbf785bf10">grppi::map_reduce</a></div><div class="ttdeci">auto map_reduce(const Execution &amp;ex, std::tuple&lt; InputIterators... &gt; firsts, std::size_t size, Identity &amp;&amp;identity, Transformer &amp;&amp;transform_op, Combiner &amp;&amp;combine_op)</div><div class="ttdoc">Invoke md_map-reduce on a data sequence.</div><div class="ttdef"><b>Definition:</b> mapreduce.h:52</div></div>
</div><!-- fragment --><p><b>Note</b>: A <b>map/reduce</b> could be also expressed by the composition of a <b>map</b> and a <b>reduce</b>. However, <b>map/reduce</b> may fuse both stages, allowing for extra optimizations.</p>
<h1><a class="anchor" id="autotoc_md640"></a>
Map/reduce variants</h1>
<p>There are several variants:</p>
<ul>
<li><em>Unary map/reduce</em>: A <b>map/reduce</b> taking a single input sequence.</li>
<li><em>N-ary map/reduce</em>: A <b>map/reduce</b> taking multiple input sequences that are combined during the <em>map</em> stage.</li>
</ul>
<h1><a class="anchor" id="autotoc_md641"></a>
Key elements in a map/reduce</h1>
<p>There are two central elements of a <b>map/reduce</b>: the <b>Transformer</b> used for the <em>map</em> stage, and the <b>Combiner</b> used for the <em>reduce</em> stage.</p>
<p>A <b>Transformer</b> may be a <b>UnaryTransformer</b> or a <b>MultiTransformer</b>.</p>
<p>A <b>UnaryTransformer</b> is any C++ callable entity that takes a data item and transforms it. The input type and the output type may differ. Thus, a unary transformer <code>op</code> is any operation that, given an input <code>x</code> of type <code>T</code> and output type <code>U</code>, makes valid the following:</p>
<div class="fragment"><div class="line">U res = op(x);</div>
</div><!-- fragment --><p>A <b>MultiTransformer</b> is any C++ callable entity that takes data items, one of each input sequence, and transforms them into an output value. The input types and the output type may differ. Thus, a multi-transformer <code>op</code> is any operation that, given the inputs <code>x1, x2, ... , xN</code> of types <code>T1, T2, ... , TN</code> and an output type <code>U</code>, makes valid the following:</p>
<div class="fragment"><div class="line">U res = op(x1, x2, ..., xN);</div>
</div><!-- fragment --><p>A <b>Combiner</b> is any C++ callable entity, that is able to combine two values into a single value. A Combiner <code>cmb</code> is any operation taking two values <code>x</code> and <code>y</code> of types <code>T</code> and <code>U</code> and returning a combined value of type <code>T</code>, making valid the following:</p>
<div class="fragment"><div class="line">T x;</div>
<div class="line">U y;</div>
<div class="line">T res = cmb(x,y);</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md642"></a>
Details on map/reduce variants</h1>
<h2><a class="anchor" id="autotoc_md643"></a>
Unary map_reduce</h2>
<p>An unary <b>map/reduce</b> takes a single data set and performs consecutively the <b>map</b> and the <b>reduce</b> stages, returning the reduced value.</p>
<p>The only interface currently offered for this pattern is based on iterators (following the C++ standard library conventions):</p>
<ul>
<li>The input data set is specified by two iterators.</li>
</ul>
<p>A unary <b>map/reduce</b> also requires an identity value for the <b>Combiner</b>.</p>
<hr  />
<p> <b>Example</b>: Transforms a sequence of strings to its corresponding double values and computes the addition of those values. </p><div class="fragment"><div class="line">vector&lt;string&gt; v { <span class="stringliteral">&quot;1.0&quot;</span>, <span class="stringliteral">&quot;2.0&quot;</span>, <span class="stringliteral">&quot;3.5&quot;</span>, <span class="stringliteral">&quot;0.25&quot;</span> };</div>
<div class="line"><span class="keyword">auto</span> res = <a class="code" href="group__mapreduce__pattern.html#ga1b61366b1688dc6d2d8dc6cbf785bf10">grppi::map_reduce</a>(exec,</div>
<div class="line">  begin(v), end(v),</div>
<div class="line">  0.0,</div>
<div class="line">  [](<span class="keywordtype">string</span> s) { <span class="keywordflow">return</span> stod(s); },</div>
<div class="line">  [](<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) { <span class="keywordflow">return</span> x+y; }</div>
<div class="line">);</div>
<div class="line"><span class="comment">// res == 6.75</span></div>
</div><!-- fragment --> <hr  />
<h2><a class="anchor" id="autotoc_md646"></a>
N-ary map/reduce</h2>
<p>A n-ary <b>map/reduce</b> takes multiple data sets and performs consecutively the <b>map</b> and <b>reduce</b> stages, returning the reduced value.</p>
<p>The only interface currently offered for this pattern is based on iterators (following the C++ standard library conventions):</p>
<ul>
<li>The first data set is specified by two iterators.</li>
<li>All the other input data sets are specified by iterators to the start of the input data sequences, assuming that the size of all sequences are, at least, as large as the first sequence.</li>
</ul>
<p>A n-ary <b>map/reduce</b> also requires an identity value for the <b>Combiner</b>.</p>
<hr  />
<p> <b>Example</b>: Compute scalar vector between two vectors of doubles. </p><div class="fragment"><div class="line">v = get_first_vector();</div>
<div class="line">w = get_second_vector();</div>
<div class="line"><span class="keyword">auto</span> res = <a class="code" href="group__mapreduce__pattern.html#ga1b61366b1688dc6d2d8dc6cbf785bf10">grppi::map_reduce</a>(exec,</div>
<div class="line">  begin(v), end(v),</div>
<div class="line">  0.0,</div>
<div class="line">  [](<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) { <span class="keywordflow">return</span> x*y; },</div>
<div class="line">  [](<span class="keywordtype">double</span> x, <span class="keywordtype">double</span> y) { <span class="keywordflow">return</span> x+y; },</div>
<div class="line">  begin(w)</div>
<div class="line">);</div>
</div><!-- fragment --> <hr  />
<h1><a class="anchor" id="autotoc_md649"></a>
Additional examples of &lt;strong&gt;map/reduce&lt;/strong&gt;</h1>
<hr  />
<p> <b>Example</b>: Count word appearances in text lines. </p><div class="fragment"><div class="line">vector&lt;string&gt; words = get_words();</div>
<div class="line"><span class="keyword">auto</span> result = <a class="code" href="group__mapreduce__pattern.html#ga1b61366b1688dc6d2d8dc6cbf785bf10">grppi::map_reduce</a>(ex,</div>
<div class="line">  words.begin(), words.end(), map&lt;string,int&gt;{},</div>
<div class="line">  [](<span class="keywordtype">string</span> word) -&gt; map&lt;string,int&gt; { return {{word, 1}}; },</div>
<div class="line">  [](map&lt;string,int&gt; &amp; lhs, <span class="keyword">const</span> map&lt;string,int&gt; &amp; rhs) -&gt; map&lt;string,int&gt; &amp; {</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp; w : rhs) {</div>
<div class="line">      lhs[w.first]+= w.second;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> lhs;</div>
<div class="line">  }</div>
<div class="line">);</div>
</div><!-- fragment --> <hr  />
 </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>
